<script>(function() {
// only want one resizer on the page
var pymChild;
document.onreadystatechange = function() {
if (typeof pymChild === 'undefined') {
pymChild = new pym.Child({
polling: 500,
renderCallback: function (w) {
document.body.style.width = w + 'px';
if (typeof pymChild !== 'undefined') pymChild.sendHeight();
}
});
}
if (document.readyState === 'complete') {
document.getElementsByClassName('folha-loader')[0].style.display = 'none';
}
}
if (document.documentElement.className.indexOf("g-resizer-v4-init") > -1) return;
document.documentElement.className += " " + "g-resizer-v4-init";
// require IE9+
if (!("querySelector" in document)) return;
function selectElements(selector, parent) {
var selection = (parent || document).querySelectorAll(selector);
return Array.prototype.slice.call(selection);
}
function setImgSrc(img) {
if (img.getAttribute("data-src") && img.getAttribute("src") != img.getAttribute("data-src")) {
img.setAttribute("src", img.getAttribute("data-src"));
}
}
function updateSize() {
var elements = selectElements("." + "g-artboard-v4[data-min-width]");
// var widthById = {};
elements.forEach(function(el) {
var parent = el.parentNode,
// width = widthById[parent.id] || Math.round(parent.getBoundingClientRect().width),
width = Math.round(parent.getBoundingClientRect().width),
minwidth = el.getAttribute("data-min-width"),
maxwidth = el.getAttribute("data-max-width");
// if (parent.id) widthById[parent.id] = width; // only if parent.id is set
if (+minwidth <= width && (+maxwidth >= width || maxwidth === null)) {
selectElements("." + "g-aiImg", el).forEach(setImgSrc);
el.style.display = "block";
} else {
el.style.display = "none";
}
});
}
updateSize();
// window.addEventListener('nyt:embed:load', updateSize); // for nyt vi compatibility
document.addEventListener("DOMContentLoaded", updateSize);
window.addEventListener("resize", throttle(updateSize, 200));
// based on underscore.js
function throttle(func, wait) {
var _now = Date.now || function() { return +new Date(); },
timeout = null, previous = 0;
var run = function() {
previous = _now();
timeout = null;
func();
};
return function() {
var remaining = wait - (_now() - previous);
if (remaining <= 0 || remaining > wait) {
if (timeout) {
clearTimeout(timeout);
}
run();
} else if (!timeout) {
timeout = setTimeout(run, remaining);
}
};
}
})()</script></body></html>